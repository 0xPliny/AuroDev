# os_invt - MHC_INVENTORY Table Operations

**Document Version:** 1.0  
**Last Updated:** 2024-12-23  
**Author:** CmL  
**Confidence Score:** 0.95

---

## Document Metadata

| Field | Value |
|-------|-------|
| **Source File** | `os_invt.cpp`, `os_invt.h` |
| **Generated From** | `MHC_INVENTORY` table definition in `database_tables.xml` |
| **Location** | `D:\ICIS\AuroDev\clogan\AuroDev\MSVC Programs\osub\` |
| **Table Name** | `MHC_INVENTORY` |
| **Primary Key** | `loadid`, `area` (composite) |
| **Generated By** | `p_ut_makdb` utility |
| **Status** | âœ… Generated - DO NOT MODIFY |

---

## Overview

The `MHC_INVENTORY` table tracks **item-level inventory** within loads. Each inventory record represents a specific item (case, unit) that is part of a load. This table provides detailed item tracking beyond the load level.

**Critical Operations:**
- Item-level tracking within loads
- Barcode/item code management
- Physical dimensions tracking
- Order/pallet association

**Relationship to LOAD:**
- One LOAD can have multiple INVT records (one per item)
- INVT provides item-level detail; LOAD provides load-level summary

---

## Table Structure

```cpp
typedef struct invt
{
    // Audit Fields
    char    modify_user[132+1];          // User who last modified record
    char    history_func[50+1];          // Function that created history entry
    char    history_comment[256+1];       // History comment text
    char    add_date[24+1];              // Date record was added
    char    add_user[132+1];             // User who added record
    char    modify_date[24+1];           // Date record was last modified
    
    // Primary Key Fields
    char    loadid[6+1];                 // Load ID (part of primary key)
    char    area[1+1];                   // System area (part of primary key)
    long    sequence_no;                 // Sequence number (part of primary key)
    
    // Item Identification Fields
    char    item_code[5+1];              // Item code
    char    barcode[42+1];               // Barcode/UPC
    char    date_frombc[6+1];            // Date from barcode (YYMMDD)
    
    // Physical Dimensions
    double  length;                      // Item length (inches)
    double  width;                       // Item width (inches)
    double  height;                      // Item height (inches)
    double  weight;                      // Item weight (pounds)
    
    // Status Fields
    char    status[15+1];                // Item status (ACTV, SHIP, etc.)
    bool    passedinboundcheck;          // Passed inbound quality check
    
    // Order/Pallet Association
    char    order_id[10+1];              // Associated order ID
    char    pallet_id[10+1];             // Associated pallet ID
    long    paldvrtsequence;             // Pallet divert sequence
    
    // Source Fields
    char    source[15+1];                 // Source identifier
    char    received_date[24+1];         // Date item was received
    
    // Comment Fields
    char    comment_1[32+1];             // Comment field 1
    char    comment_2[32+1];             // Comment field 2
    
    // History Fields
    long    history_onoff;               // History on/off flag
    long    history_sequence_no;         // History sequence number
    
    // Internal Fields
    char    INVT_dum[1];                 // Dummy field (alignment)
    _RecordsetPtr    RsP;                // ADO Recordset pointer (internal use)
} INVT;
```

---

## Primary Key

| Field(s) | Type | Description |
|----------|------|-------------|
| `loadid` | `char[7]` | Load identifier |
| `area` | `char[2]` | System area |
| `sequence_no` | `long` | Sequence number (unique within load) |

**Note:** The composite primary key allows multiple items per load, with `sequence_no` providing uniqueness.

---

## Generated Functions

### INVT_select_INVT_PR_KEY

**Signature:**
```cpp
long INVT_select_INVT_PR_KEY(INVT *sel, GP_BOOL Update);
```

**Description:**
Selects a single INVT record by primary key (`loadid`, `area`, `sequence_no`).

**SQL Generated:**
```sql
SELECT * FROM MHC_INVENTORY WHERE loadid = '{loadid}' AND area = '{area}' AND sequence_no = {sequence_no}
```

**Usage Example:**
```cpp
INVT invt;
INVT_init(&invt);
cc_str.copy(invt.loadid, sizeof(invt.loadid), "L00001");
cc_str.copy(invt.area, sizeof(invt.area), "A");
invt.sequence_no = 1;

if (INVT_select_INVT_PR_KEY(&invt, GP_FALSE) == GP.GOOD) {
    cs_log_printf(FILELINE, 3, "Item: %s, barcode: %s", 
                  invt.item_code, invt.barcode);
}
```

---

### INVT_select_LOOP

**Signature:**
```cpp
long INVT_select_LOOP(INVT *sel, long *count, char *where, GP_BOOL Update, int top = 0);
```

**Description:**
Selects multiple INVT records using a WHERE clause. Commonly used to get all items in a load.

**Usage Example:**
```cpp
INVT invt;
INVT_init(&invt);
long count = 0;
char where[256];
sprintf(where, "loadid = 'L00001' AND area = 'A' ORDER BY sequence_no");

// Get all items in load
while (INVT_select_LOOP(&invt, &count, where, GP_FALSE, 0) == GP.GOOD) {
    cs_log_printf(FILELINE, 3, "Item %ld: %s (barcode: %s)", 
                  invt.sequence_no, invt.item_code, invt.barcode);
}

count = -1;
INVT_select_LOOP(&invt, &count, "", GP_FALSE, 0);
```

---

### INVT_insert

**Signature:**
```cpp
long INVT_insert(INVT *sel, ...);
```

**Description:**
Inserts a new INVT record. Used when adding items to a load.

**Required Fields:**
- `loadid`, `area`, `sequence_no` (primary key)
- `item_code` or `barcode`
- `status`
- `add_date`, `add_user`

**Usage Example:**
```cpp
SQL.start(SQL.READ_WRITE);

INVT invt;
INVT_init(&invt);

// Set primary key
cc_str.copy(invt.loadid, sizeof(invt.loadid), "L00001");
cc_str.copy(invt.area, sizeof(invt.area), "A");
invt.sequence_no = 1;

// Set item data
cc_str.copy(invt.item_code, sizeof(invt.item_code), "ITEM1");
cc_str.copy(invt.barcode, sizeof(invt.barcode), "1234567890123");
cc_str.copy(invt.status, sizeof(invt.status), "ACTV");
invt.length = 12.0;
invt.width = 8.0;
invt.height = 6.0;
invt.weight = 5.5;

// Set audit fields
double curDate;
cs_dtm_current(&curDate);
cs_dtm_fmt(invt.add_date, sizeof(invt.add_date), curDate, DTM_MASK);
cc_str.copy(invt.add_user, sizeof(invt.add_user), gg.prgnam());

if (INVT_insert(&invt) == GP.GOOD) {
    SQL.commit();
} else {
    SQL.rollback();
}
```

---

### INVT_update

**Signature:**
```cpp
long INVT_update(INVT *sel);
```

**Description:**
Updates an existing INVT record.

---

### INVT_count

**Signature:**
```cpp
long INVT_count(INVT *sel, long* i_count, char *where);
```

**Description:**
Counts INVT records matching a WHERE clause. Commonly used to count items in a load.

**Usage Example:**
```cpp
INVT invt;
INVT_init(&invt);
long itemCount = 0;
char where[256];
sprintf(where, "loadid = 'L00001' AND area = 'A'");

if (INVT_count(&invt, &itemCount, where) == GP.GOOD) {
    cs_log_printf(FILELINE, 3, "Load L00001 has %ld items", itemCount);
}
```

---

## Common Usage Patterns

### Pattern 1: Get All Items in Load

```cpp
INVT invt;
INVT_init(&invt);
long count = 0;
char where[256];
sprintf(where, "loadid = '%s' AND area = '%s' ORDER BY sequence_no", 
        loadId, area);

while (INVT_select_LOOP(&invt, &count, where, GP_FALSE, 0) == GP.GOOD) {
    // Process each item
    processItem(&invt);
}

count = -1;
INVT_select_LOOP(&invt, &count, "", GP_FALSE, 0);
```

### Pattern 2: Find Item by Barcode

```cpp
INVT invt;
INVT_init(&invt);
long count = 0;
char where[256];
sprintf(where, "barcode = '%s' AND area = 'A'", barcode);

if (INVT_select_LOOP(&invt, &count, where, GP_FALSE, 1) == GP.GOOD) {
    // Found item
    cs_log_printf(FILELINE, 3, "Found item in load %s", invt.loadid);
    count = -1;
    INVT_select_LOOP(&invt, &count, "", GP_FALSE, 0);
    return GP.GOOD;
} else {
    count = -1;
    INVT_select_LOOP(&invt, &count, "", GP_FALSE, 0);
    return GP.UGLY; // Not found
}
```

---

## Related Tables

| Table | Relationship | Foreign Key |
|-------|--------------|-------------|
| `MHC_LOAD` | Parent | `MHC_INVENTORY.loadid = MHC_LOAD.loadid` |
| `MHC_ORDER` | Reference | `MHC_INVENTORY.order_id = MHC_ORDER.order_id` |
| `MHC_PALLET` | Reference | `MHC_INVENTORY.pallet_id = MHC_PALLET.pallet_id` |

---

## Cross-References

| Topic | Document | Section |
|-------|----------|---------|
| Database Schema | [MHC_INVENTORY Schema](../../04_Database_Reference/01_Core_Tables/MHC_INVENTORY.md) | Table Definition |
| Load Operations | [os_load.md](os_load.md) | LOAD contains INVT |
| Workflows | [Inbound Move](../../05_Workflows/01_Inbound_Move.md) | Item Creation |

---

## Changelog

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2024-12-23 | Initial comprehensive documentation |

