# os_errors - MHC_ERRORS Table Operations

**Document Version:** 1.0  
**Last Updated:** 2024-12-23  
**Author:** CmL  
**Confidence Score:** 0.95

---

## Document Metadata

| Field | Value |
|-------|-------|
| **Source File** | `os_errors.cpp`, `os_errors.h` |
| **Generated From** | `MHC_ERRORS` table definition in `database_tables.xml` |
| **Location** | `D:\ICIS\AuroDev\clogan\AuroDev\MSVC Programs\osub\` |
| **Table Name** | `MHC_ERRORS` |
| **Primary Key** | `device_type`, `device_number`, `area`, `error_number`, `error_customer`, `sequence_no` (composite) |
| **Generated By** | `p_ut_makdb` utility |
| **Status** | âœ… Generated - DO NOT MODIFY |

---

## Overview

The `MHC_ERRORS` table stores **active (unresolved) errors** for all devices in the system. When an error is resolved, it is moved to `MHC_ERROR_HISTORY`.

**Critical Operations:**
- Error logging and tracking
- Error resolution (move to history)
- Error querying by device
- Error counting and reporting

---

## Table Structure

```cpp
typedef struct errors
{
    // Primary Key Fields
    long    device_type;                 // Device type (see GP.DEV.TYP)
    long    device_number;                // Device number
    char    area[1+1];                   // System area
    long    error_number;                 // Error number
    long    error_customer;               // Customer error code
    long    sequence_no;                  // Sequence number (for multiple errors)
    
    // Device Identification Fields
    char    device_name[50+1];            // Device name (e.g., "SR01", "PD01")
    char    device_sub_type[20+1];        // Device sub-type
    
    // Error Information Fields
    char    message_text[255+1];          // Error message text
    char    close_date[24+1];             // Error close date (NULL if active)
    
    // Audit Fields
    char    add_date[24+1];               // Date error was added
    char    add_user[132+1];              // User who added error
    char    modify_date[24+1];            // Date record was last modified
    char    modify_user[132+1];            // User who last modified record
    
    // Internal Fields
    _RecordsetPtr    RsP;                 // ADO Recordset pointer (internal use)
} ERRORS;
```

---

## Primary Key

| Field(s) | Type | Description |
|----------|------|-------------|
| `device_type` | `long` | Device type code |
| `device_number` | `long` | Device number |
| `area` | `char[2]` | System area |
| `error_number` | `long` | Error number |
| `error_customer` | `long` | Customer error code |
| `sequence_no` | `long` | Sequence number |

---

## Generated Functions

### ERRORS_select_ERRORS_PR_KEY

**Signature:**
```cpp
long ERRORS_select_ERRORS_PR_KEY(ERRORS *sel, GP_BOOL Update);
```

**Description:**
Selects a single ERRORS record by primary key.

**SQL Generated:**
```sql
SELECT * FROM MHC_ERRORS WHERE device_type = {device_type} 
  AND device_number = {device_number} 
  AND area = '{area}' 
  AND error_number = {error_number} 
  AND error_customer = {error_customer} 
  AND sequence_no = {sequence_no}
```

---

### ERRORS_select_LOOP

**Signature:**
```cpp
long ERRORS_select_LOOP(ERRORS *sel, long *count, char *where, GP_BOOL Update, int top = 0);
```

**Description:**
Selects multiple ERRORS records using a WHERE clause. Commonly used to get all active errors for a device.

**Usage Example:**
```cpp
ERRORS errors;
ERRORS_init(&errors);
long count = 0;
char where[256];
sprintf(where, "device_name = 'SR01' AND area = 'A' AND close_date IS NULL ORDER BY add_date");

// Get all active errors for SR01
while (ERRORS_select_LOOP(&errors, &count, where, GP_FALSE, 0) == GP.GOOD) {
    cs_log_printf(FILELINE, 0, "Active error: %s - %s", 
                  errors.device_name, errors.message_text);
}

count = -1;
ERRORS_select_LOOP(&errors, &count, "", GP_FALSE, 0);
```

---

### ERRORS_insert

**Signature:**
```cpp
long ERRORS_insert(ERRORS *sel, ...);
```

**Description:**
Inserts a new ERRORS record. Used when logging a new error.

---

### ERRORS_update

**Signature:**
```cpp
long ERRORS_update(ERRORS *sel);
```

**Description:**
Updates an existing ERRORS record. Commonly used to set `close_date` when resolving an error.

**Usage Example:**
```cpp
SQL.start(SQL.READ_WRITE);

ERRORS errors;
ERRORS_init(&errors);
// Set primary key fields...

if (ERRORS_select_ERRORS_PR_KEY(&errors, GP_TRUE) == GP.GOOD) {
    // Close the error
    double curDate;
    cs_dtm_current(&curDate);
    cs_dtm_fmt(errors.close_date, sizeof(errors.close_date), curDate, DTM_MASK);
    
    if (ERRORS_update(&errors) == GP.GOOD) {
        // Move to history
        // ... (code to insert into ERRHIST)
        SQL.commit();
    } else {
        SQL.rollback();
    }
}
```

---

## Related Tables

| Table | Relationship | Foreign Key |
|-------|--------------|-------------|
| `MHC_ERROR_HISTORY` | Related | Resolved errors moved here |
| `MHC_STK` | Reference | `MHC_ERRORS.device_name = MHC_STK.devicename` |
| `MHC_STTN` | Reference | `MHC_ERRORS.device_name = MHC_STTN.station` |

---

## Cross-References

| Topic | Document | Section |
|-------|----------|---------|
| Error History | [os_errhist.md](os_errhist.md) | Resolved errors |
| Error Handling | [Error Handling](../../06_Troubleshooting/01_Error_Handling.md) | Error Resolution |

---

## Changelog

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2024-12-23 | Initial comprehensive documentation |

