# os_sys - MHC_SYS Table Operations

**Document Version:** 1.0  
**Last Updated:** 2024-12-23  
**Author:** CmL  
**Confidence Score:** 0.95

---

## Document Metadata

| Field | Value |
|-------|-------|
| **Source File** | `os_sys.cpp`, `os_sys.h` |
| **Generated From** | `MHC_SYS` table definition in `database_tables.xml` |
| **Location** | `D:\ICIS\AuroDev\clogan\AuroDev\MSVC Programs\osub\` |
| **Table Name** | `MHC_SYS` |
| **Primary Key** | `area` |
| **Generated By** | `p_ut_makdb` utility |
| **Status** | âœ… Generated - DO NOT MODIFY |

---

## Overview

The `MHC_SYS` table stores **system-wide configuration and status** for each area. There is typically one SYS record per system area (usually just one record for area "A"). This table tracks system state, operational modes, and control flags.

**Critical Operations:**
- System status checking
- Auto/manual mode control
- System initialization tracking
- Warm start tracking

---

## Table Structure

```cpp
typedef struct sys
{
    // Version Control
    long    version_cpp;                 // C++ version (for shared memory compatibility)
    
    // Primary Key
    char    area[1+1];                   // System area (typically "A")
    
    // System Status Fields
    long    on_dsc;                      // On/off descriptor
    long    auto_mode;                   // Auto mode flag (1=auto, 0=manual)
    long    auto_dialog;                  // Auto dialog flag
    long    down;                        // System down flag
    long    up;                          // System up flag
    long    warm;                        // Warm start flag
    char    warm_dtm[24+1];             // Warm start date/time
    
    // Operational Control Fields
    long    bcr;                         // BCR enabled flag
    long    device_errors;               // Device errors flag
    long    dialog;                      // Dialog enabled flag
    long    dialog_trace;                // Dialog trace flag
    long    loglvl;                      // Log level (0-10)
    long    log_operator;                // Log operator flag
    long    pause_assembly;              // Pause assembly flag
    long    pause_press;                 // Pause press flag
    long    process_hung;                // Process hung flag
    long    process_died;                // Process died flag
    long    runner;                      // Runner flag
    long    simu;                        // Simulation mode flag
    long    simu_time;                   // Simulation time multiplier
    long    ship_bypass;                 // Ship bypass flag
    long    travel_enabled;               // Travel enabled flag
    
    // Time Tracking Fields
    char    last_run_time[24+1];         // Last run time
    char    start_gap_time[24+1];        // Start gap time
    char    end_gap_time[24+1];          // End gap time
    
    // Audit Fields
    char    add_date[24+1];              // Date record was added
    char    add_user[132+1];             // User who added record
    char    modify_date[24+1];           // Date record was last modified
    char    modify_user[132+1];          // User who last modified record
    
    // Internal Fields
    _RecordsetPtr    RsP;                // ADO Recordset pointer (internal use)
} SYS;
```

---

## Primary Key

| Field(s) | Type | Description |
|----------|------|-------------|
| `area` | `char[2]` | System area (typically "A") |

**Note:** There is typically only one SYS record per system (area "A").

---

## Generated Functions

### SYS_select_SYS_PR_KEY

**Signature:**
```cpp
long SYS_select_SYS_PR_KEY(SYS *sel, GP_BOOL Update);
```

**Description:**
Selects the SYS record by primary key (`area`). This is typically called once at system startup.

**SQL Generated:**
```sql
SELECT * FROM MHC_SYS WHERE area = '{area}'
```

**Usage Example:**
```cpp
SYS sys;
SYS_init(&sys);
cc_str.copy(sys.area, sizeof(sys.area), "A");

if (SYS_select_SYS_PR_KEY(&sys, GP_FALSE) == GP.GOOD) {
    if (sys.auto_mode == 1) {
        cs_log_printf(FILELINE, 3, "System in AUTO mode");
    } else {
        cs_log_printf(FILELINE, 3, "System in MANUAL mode");
    }
}
```

---

### SYS_update

**Signature:**
```cpp
long SYS_update(SYS *sel);
```

**Description:**
Updates the SYS record. Used to change system-wide settings.

**Usage Example:**
```cpp
SQL.start(SQL.READ_WRITE);

SYS sys;
SYS_init(&sys);
cc_str.copy(sys.area, sizeof(sys.area), "A");

if (SYS_select_SYS_PR_KEY(&sys, GP_TRUE) == GP.GOOD) {
    // Change to auto mode
    sys.auto_mode = 1;
    
    // Update audit
    double curDate;
    cs_dtm_current(&curDate);
    cs_dtm_fmt(sys.modify_date, sizeof(sys.modify_date), curDate, DTM_MASK);
    cc_str.copy(sys.modify_user, sizeof(sys.modify_user), gg.prgnam());
    
    if (SYS_update(&sys) == GP.GOOD) {
        SQL.commit();
        cs_log_printf(FILELINE, 3, "System mode changed to AUTO");
    } else {
        SQL.rollback();
    }
}
```

---

## Common Usage Patterns

### Pattern 1: Check System Status

```cpp
SYS sys;
SYS_init(&sys);
cc_str.copy(sys.area, sizeof(sys.area), "A");

if (SYS_select_SYS_PR_KEY(&sys, GP_FALSE) == GP.GOOD) {
    if (sys.down == 1) {
        cs_log_printf(FILELINE, 0, "System is DOWN");
        return GP.BAD;
    }
    if (sys.auto_mode == 0) {
        cs_log_printf(FILELINE, 3, "System in MANUAL mode");
    }
}
```

---

## Related Tables

| Table | Relationship | Description |
|-------|--------------|-------------|
| None | N/A | SYS is a standalone configuration table |

---

## Cross-References

| Topic | Document | Section |
|-------|----------|---------|
| System Initialization | [p_sy_dbini](../01_Background_Processes/p_sy_dbini.md) | Uses SYS |
| System Startup | [System Startup Sequence](../../05_Workflows/04_System_Startup_Shutdown.md) | SYS Status |

---

## Changelog

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2024-12-23 | Initial comprehensive documentation |

