# os_grpmem - MHC_GRPMEM Table Operations

**Document Version:** 1.0  
**Last Updated:** 2024-12-23  
**Author:** CmL  
**Confidence Score:** 0.95

---

## Document Metadata

| Field | Value |
|-------|-------|
| **Source File** | `os_grpmem.cpp`, `os_grpmem.h` |
| **Generated From** | `MHC_GRPMEM` table definition in `database_tables.xml` |
| **Location** | `D:\ICIS\AuroDev\clogan\AuroDev\MSVC Programs\osub\` |
| **Table Name** | `MHC_GRPMEM` |
| **Primary Key** | `groupname`, `membername`, `area` (composite) |
| **Generated By** | `p_ut_makdb` utility |
| **Status** | âœ… Generated - DO NOT MODIFY |

---

## Overview

The `MHC_GRPMEM` table stores **group membership** - which locations or devices belong to which groups. This is used for location selection and routing optimization.

**Critical Operations:**
- Group membership management
- Location-to-group assignment
- Priority-based location selection

---

## Table Structure

```cpp
typedef struct grpmem
{
    // Primary Key Fields
    char    groupname[30+1];              // Group name (references MHC_GROUPS)
    char    membername[30+1];             // Member name (typically a location)
    char    area[1+1];                    // System area
    
    // Priority Field
    long    priority;                     // Selection priority (lower = higher priority)
    
    // Control Field
    bool    dont_use;                     // Don't use flag (exclude from selection)
    
    // Audit Fields
    char    add_date[24+1];               // Date record was added
    char    add_user[132+1];              // User who added record
    char    modify_date[24+1];            // Date record was last modified
    char    modify_user[132+1];            // User who last modified record
    
    // Internal Fields
    char    GRPMEM_dum[2];                // Dummy field (alignment)
    _RecordsetPtr    RsP;                 // ADO Recordset pointer (internal use)
} GRPMEM;
```

---

## Primary Key

| Field(s) | Type | Description |
|----------|------|-------------|
| `groupname` | `char[31]` | Group name |
| `membername` | `char[31]` | Member name (location or device) |
| `area` | `char[2]` | System area |

---

## Generated Functions

### GRPMEM_select_GRPMEM_PR_KEY

**Signature:**
```cpp
long GRPMEM_select_GRPMEM_PR_KEY(GRPMEM *sel, GP_BOOL Update);
```

**Description:**
Selects a single GRPMEM record by primary key.

**SQL Generated:**
```sql
SELECT * FROM MHC_GRPMEM WHERE groupname = '{groupname}' 
  AND membername = '{membername}' 
  AND area = '{area}'
```

---

### GRPMEM_select_LOOP

**Signature:**
```cpp
long GRPMEM_select_LOOP(GRPMEM *sel, long *count, char *where, GP_BOOL Update, int top = 0);
```

**Description:**
Selects multiple GRPMEM records using a WHERE clause. Commonly used to get all members of a group.

**Usage Example:**
```cpp
GRPMEM grpmem;
GRPMEM_init(&grpmem);
long count = 0;
char where[256];
sprintf(where, "groupname = 'GROUP1' AND area = 'A' AND dont_use = 0 ORDER BY priority");

// Get all active members of GROUP1, sorted by priority
while (GRPMEM_select_LOOP(&grpmem, &count, where, GP_FALSE, 0) == GP.GOOD) {
    cs_log_printf(FILELINE, 3, "Group member: %s (priority: %ld)", 
                  grpmem.membername, grpmem.priority);
}

count = -1;
GRPMEM_select_LOOP(&grpmem, &count, "", GP_FALSE, 0);
```

---

## Related Tables

| Table | Relationship | Foreign Key |
|-------|--------------|-------------|
| `MHC_GROUPS` | Parent | `MHC_GRPMEM.groupname = MHC_GROUPS.groupname` |
| `MHC_LOCATION` | Reference | `MHC_GRPMEM.membername = MHC_LOCATION.location` |

---

## Cross-References

| Topic | Document | Section |
|-------|----------|---------|
| Groups | [os_groups.md](os_groups.md) | GROUPS table |
| Location Selection | [DSUB Library](../dsub.md) | ds_get_locn uses groups |

---

## Changelog

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2024-12-23 | Initial comprehensive documentation |

