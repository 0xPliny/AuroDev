# os_errhist - MHC_ERROR_HISTORY Table Operations

**Document Version:** 1.0  
**Last Updated:** 2024-12-23  
**Author:** CmL  
**Confidence Score:** 0.95

---

## Document Metadata

| Field | Value |
|-------|-------|
| **Source File** | `os_errhist.cpp`, `os_errhist.h` |
| **Generated From** | `MHC_ERROR_HISTORY` table definition in `database_tables.xml` |
| **Location** | `D:\ICIS\AuroDev\clogan\AuroDev\MSVC Programs\osub\` |
| **Table Name** | `MHC_ERROR_HISTORY` |
| **Primary Key** | `device_type`, `device_number`, `area`, `error_number`, `error_customer` (composite) |
| **Generated By** | `p_ut_makdb` utility |
| **Status** | âœ… Generated - DO NOT MODIFY |

---

## Overview

The `MHC_ERROR_HISTORY` table stores **resolved (closed) errors** that have been moved from `MHC_ERRORS`. This provides a historical record of all errors that have occurred in the system.

**Critical Operations:**
- Error history tracking
- Historical error analysis
- Error reporting and statistics

---

## Table Structure

```cpp
typedef struct errhist
{
    // Primary Key Fields
    long    device_type;                 // Device type (see GP.DEV.TYP)
    long    device_number;               // Device number
    char    area[1+1];                   // System area
    long    error_number;                 // Error number
    long    error_customer;               // Customer error code
    
    // Device Identification Fields
    char    device_name[50+1];            // Device name (e.g., "SR01", "PD01")
    char    device_sub_type[20+1];        // Device sub-type
    
    // Error Information Fields
    char    message_text[255+1];          // Error message text
    char    create_date[24+1];            // Error creation date
    char    close_date[24+1];             // Error close/resolution date
    
    // Audit Fields
    char    add_date[24+1];               // Date record was added
    char    add_user[132+1];              // User who added record
    char    modify_date[24+1];            // Date record was last modified
    char    modify_user[132+1];            // User who last modified record
    
    // Internal Fields
    _RecordsetPtr    RsP;                 // ADO Recordset pointer (internal use)
} ERRHIST;
```

---

## Primary Key

| Field(s) | Type | Description |
|----------|------|-------------|
| `device_type` | `long` | Device type code |
| `device_number` | `long` | Device number |
| `area` | `char[2]` | System area |
| `error_number` | `long` | Error number |
| `error_customer` | `long` | Customer error code |

**Note:** No `sequence_no` in primary key (only one history record per error).

---

## Generated Functions

### ERRHIST_select_ERRHIST_PR_KEY

**Signature:**
```cpp
long ERRHIST_select_ERRHIST_PR_KEY(ERRHIST *sel, GP_BOOL Update);
```

**Description:**
Selects a single ERRHIST record by primary key.

---

### ERRHIST_select_LOOP

**Signature:**
```cpp
long ERRHIST_select_LOOP(ERRHIST *sel, long *count, char *where, GP_BOOL Update, int top = 0);
```

**Description:**
Selects multiple ERRHIST records using a WHERE clause. Commonly used for error history reporting.

**Usage Example:**
```cpp
ERRHIST errhist;
ERRHIST_init(&errhist);
long count = 0;
char where[256];
sprintf(where, "device_name = 'SR01' AND area = 'A' AND create_date >= '2024-12-01' ORDER BY create_date DESC");

// Get error history for SR01 in December
while (ERRHIST_select_LOOP(&errhist, &count, where, GP_FALSE, 0) == GP.GOOD) {
    cs_log_printf(FILELINE, 3, "Error history: %s - %s (created: %s, closed: %s)", 
                  errhist.device_name, errhist.message_text, 
                  errhist.create_date, errhist.close_date);
}

count = -1;
ERRHIST_select_LOOP(&errhist, &count, "", GP_FALSE, 0);
```

---

## Related Tables

| Table | Relationship | Foreign Key |
|-------|--------------|-------------|
| `MHC_ERRORS` | Source | Errors moved from ERRORS to ERRHIST |
| `MHC_STK` | Reference | `MHC_ERROR_HISTORY.device_name = MHC_STK.devicename` |
| `MHC_STTN` | Reference | `MHC_ERROR_HISTORY.device_name = MHC_STTN.station` |

---

## Cross-References

| Topic | Document | Section |
|-------|----------|---------|
| Active Errors | [os_errors.md](os_errors.md) | ERRORS table |
| Error Reporting | [Statistics](../../07_Statistics/01_Error_Statistics.md) | Error Analysis |

---

## Changelog

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2024-12-23 | Initial comprehensive documentation |

